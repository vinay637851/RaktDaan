<style>
    .container {
        min-height: 90vh;
        display: flex;
        padding: 5vh 0vh;
        gap: 10vh;
        justify-content: space-between;
        align-items: center;
        background-color: #f4f4f4;
        flex-direction: column;
    }
    .box{
        background-color: white;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        width: 90vw;
        height: 60vh;
        display: flex;
        justify-content: space-around;
        align-items: center;
        padding: 2vw;
        flex-direction: column;
    }
    h2{
        color: #c21313;
        transform: scaleY(1.1);
        font-weight: 600;
        letter-spacing: 1px;
    }
    .search{
        width: 85vw;
        height: max-content;
        border-radius: 0.5rem;
        align-items: center;
        justify-content: space-between;
        display: flex;
        flex-direction: column;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
    }
    .search h3{
        width: 100%;
    }
    .search select{
        width: 20vw;
        height: 5vh;
        padding: 0px 10px;
        background-color: #e6f7ff;
        border: 1px solid #ccc;
        border-radius: 4px;
        transition: border-color 0.3s ease;
    }
    .search select:focus {
        border-color: #5cb85c;
        outline: none;
    }
    .search option{
        color: rgba(0, 0, 0, 0.8);
    }
    .search h3{
        border-radius: 0.5rem 0.5rem 0rem 0rem;
        background-color:#BF222B ;
        height: 5vh;
        display: flex;
        align-items: center;
        padding-left: 1vw;
        font-weight: 500;
        letter-spacing: 1px;
        color: white;
    }
    .search form{
        border-radius: 0rem 0rem 0.5rem 0.5rem;
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding-bottom: 10px;
    }
    .search div{
        width: 100%;
        height: 15vh;
        padding: 2vh;
        display: flex;
        justify-content: space-between;
        align-items: center;

    }
    .show_details{
        width: 90vw;
        min-height: 20vh;
        background-color: white;
        border-radius: 0.5rem 0.5rem 0rem 0rem;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
        padding: 10px;
    }
    .show_details th{
        background-color: #BF222B;
        width: 20vw;
        text-align: center;
        color: white;
        height: 6vh;
    }
    .show_details td{
        height: 7vh;
        background-color:  #d0e9f9;
        color: #333;
        text-align: center;
    }
    button{
        width: 6vw;
        padding: 10px;
        background-color: #c21313;
        color: white;
        font-size: 16px;
        border: none;
        border-radius: .5rem;
        cursor: pointer;
    }
    button:hover{
        background-color: brown;
    }
</style>
<%-include('header')%>
<div class="container">
    <div class="box">
        <h2>Blood Stock Availability</h2>
        <div class="search">
            <h3>Search Blood Stock</h3>
            <form action="/availability/dashboard/blood_stock" method="post">
                <div>
                    <select name="state" id="" required>
                        <option value="">Select State</option>
                        <option value="Madhya Pradesh">Madhya Pradesh</option>
                    </select>
                    <select name="district" id="district" required>
                        <option value="">Select a District</option>
                        <option value="Agar Malwa">Agar Malwa</option>
                        <option value="Alirajpur">Alirajpur</option>
                        <option value="Anuppur">Anuppur</option>
                        <option value="Ashok Nagar">Ashok Nagar</option>
                        <option value="Balaghat">Balaghat</option>
                        <option value="Barwani">Barwani</option>
                        <option value="Betul">Betul</option>
                        <option value="Bhind">Bhind</option>
                        <option value="Bhopal">Bhopal</option>
                        <option value="Burhanpur">Burhanpur</option>
                        <option value="Chhatarpur">Chhatarpur</option>
                        <option value="Chhindwara">Chhindwara</option>
                        <option value="Damoh">Damoh</option>
                        <option value="Datia">Datia</option>
                        <option value="Dewas">Dewas</option>
                        <option value="Dhar">Dhar</option>
                        <option value="Dindori">Dindori</option>
                        <option value="Guna">Guna</option>
                        <option value="Gwalior">Gwalior</option>
                        <option value="Harda">Harda</option>
                        <option value="Hoshangabad">Hoshangabad</option>
                        <option value="Indore">Indore</option>
                        <option value="Jabalpur">Jabalpur</option>
                        <option value="Jhabua">Jhabua</option>
                        <option value="Katni">Katni</option>
                        <option value="Khandwa">Khandwa</option>
                        <option value="Khargone">Khargone</option>
                        <option value="Mandla">Mandla</option>
                        <option value="Mandsaur">Mandsaur</option>
                        <option value="Morena">Morena</option>
                        <option value="Narsinghpur">Narsinghpur</option>
                        <option value="Neemuch">Neemuch</option>
                        <option value="Panna">Panna</option>
                        <option value="Rajgarh">Rajgarh</option>
                        <option value="Ratlam">Ratlam</option>
                        <option value="Rewa">Rewa</option>
                        <option value="Sagar">Sagar</option>
                        <option value="Satna">Satna</option>
                        <option value="Sehore">Sehore</option>
                        <option value="Shahdol">Shahdol</option>
                        <option value="Shajapur">Shajapur</option>
                        <option value="Sheopur">Sheopur</option>
                        <option value="Sidhi">Sidhi</option>
                        <option value="Singrauli">Singrauli</option>
                        <option value="Tikamgarh">Tikamgarh</option>
                        <option value="Ujjain">Ujjain</option>
                        <option value="Umaria">Umaria</option>
                        <option value="Vidisha">Vidisha</option>
                    </select>
                    <select name="blood_group" id="blood_group" required>
                        <option value="" disabled selected>Select your blood type</option>
                        <option value="A+">A+</option>
                        <option value="A-">A-</option>
                        <option value="B+">B+</option>
                        <option value="B-">B-</option>
                        <option value="AB+">AB+</option>
                        <option value="AB-">AB-</option>
                        <option value="O+">O+</option>
                        <option value="O-">O-</option>
                    </select>                               
                </div>
                <button>Search</button>
            </form>
        </div>
        <p style="font-size: 12px ; color:gray;">Please Select State , District and Blood Type for stock availability.</p>
    </div>
    <div class="show_details">
        <table>
            <thead>
                <th>S.No.</th>
                <th>Blood Bank Name</th>
                <th>Category</th>
                <th>Address</th>
                <th>Contact Info.</th>
                <th>Availability</th>
                <th>Last Updated</th>
            </thead>
            <tbody>

            </tbody>
        </table>        
    </div>
</div>
<script>
    let bank=<%-JSON.stringify(bank_details||[])%>;
    let inventory=<%-JSON.stringify(inventory_details||[])%>;
    let idx=1;
    document.querySelector('.search form').addEventListener('submit',function(e){
        e.preventDefault();
        this.submit();
    })
    for(let i=0;i<bank.length;i++) {
        for(let j=0;j<inventory.length;j++){
            if(bank[i]['bank_id']===inventory[j]['bank_id']){
                let row=document.createElement('tr');
                let cell=document.createElement('td');
                cell.textContent=idx;
                idx++;
                row.appendChild(cell);
                for(let key in bank[i]){
                    if(key=='Blood_Bank_Name'||key=='Address'||key=='Category'){
                        let cell=document.createElement('td');
                        cell.textContent=bank[i][key];
                        row.appendChild(cell);
                    }
                }
                cell=document.createElement('td');
                cell.innerHTML="Email: "+bank[i]['Email']+"<br>"+"Contact No. "+bank[i]['Contact_No'];
                row.appendChild(cell);
                if(inventory[j]['quantity']>0){
                    cell=document.createElement('td');
                    cell.textContent="Available "+inventory[j]['bloodgroup'];
                    cell.style.color='green';
                    row.appendChild(cell);
                }
                else{
                    cell=document.createElement('td');
                    cell.textContent="Out of Stock "+inventory[j]['bloodgroup'];
                    cell.style.color='red'
                    row.appendChild(cell);
                }
                cell=document.createElement('td');
                let update_date=inventory[j]['last_updated_date'];
                let date=new Date(update_date);
                cell.textContent=date.toDateString();
                row.appendChild(cell);
                document.querySelector('.show_details tbody').appendChild(row);
            }
        }
    }
</script>
<%-include('footer')%>